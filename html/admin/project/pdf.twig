<style>
    body {
        font-size: 12px;
        font-family: 'Helvetica Neue', 'Helvetica', Helvetica, Arial, sans-serif;
    }

     table {
        width: 100%;
         border-collapse: collapse;
    }

     table td {
        vertical-align: top;
    }
    th, td {
        padding-left: 5px;
        padding-right: 5px;
        padding-bottom: 1px;
        padding-top: 1px;
    }
</style>
<body>
<htmlpageheader name="firstpage" style="display:none">
</htmlpageheader>
<htmlpageheader name="otherpages" style="display:none">
    <table width="100%">
        <tr>
            <td width="50%"><b>{{ USERDATA['instance']['instances_name'] }}</b></td>
            <td width="50%" style="text-align: right;"> {{  project['clients_name'] }} - {{ project['projects_name'] }}</td>
        </tr>
    </table>
</htmlpageheader>
<sethtmlpageheader name="firstpage" value="on" show-this-page="1" />
<sethtmlpageheader name="otherpages" value="on" />
<div style="width: 100%;" align="center">
    {% if USERDATA.instance.instances_logo %}
    <img src="{{ USERDATA.instance.instances_logo|s3URL("medium") }}" style="width: 200px; padding:20px;">
    {% endif %}
</div>
<table style="font-size: 16px;">
    <tr>
        <td>
            <b>{{ project.clients_name }}</b><br/>
            {{ project.clients_address|nl2br }}<br/><br/>
            {{ project.clients_website }}<br/>
            {{ project.clients_email }}<br/>
            {{ project.clients_phone }}<br/>
        </td>
        <td style="text-align: right;">
            <b>{{ USERDATA['instance']['instances_name'] }}</b><br/>
            {{ USERDATA.instance.instances_address|nl2br }}<br/>
            {{ USERDATA.instance.instances_website }}<br/>
            {{ USERDATA.instance.instances_phone ? USERDATA.instance.instances_phone ~ "<br/>"}}
            {{ USERDATA.instance.instances_email }}<br/><br/>
            <b>{{ project.users_name1 ~ " " ~ project.users_name2  }}</b><br/>
            {{ project.users_email }}

        </td>
    </tr>
</table>
<h1>{{ project.projects_name }}</h1>
<table style="background-color: #F5F5F5; font-size: 16px;">
    <tr>
        <td style="padding: 8px;">
            <table>
                <tr>
                    <td style="padding:0;">Our&nbsp;Reference:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{project.projects_id}}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Deliver:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{project.projects_dates_deliver_start ? project.projects_dates_deliver_start|date("j M Y h:ia")}}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Start:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{project.projects_dates_use_start ? project.projects_dates_use_start|date("j M Y h:ia")}}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Finish:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{ project.projects_dates_use_end ? project.projects_dates_use_end|date("j M Y h:ia") }}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Collect:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{ project.projects_dates_deliver_end ? project.projects_dates_deliver_end|date("j M Y h:ia") }}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Mass Estimate:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{FINANCIALS.mass|mass }}</td>
                </tr>
                <tr>
                    <td style="padding:0;">Value Estimate:</td>
                    <td style="padding: 1px 0px 1px 5px;">{{FINANCIALS.value|money }}</td>
                </tr>
            </table>
        </td>
        <td style="text-align: right;padding: 8px;">
            <b>Venue</b><br/>
            {{ project.locations_name }}<br/>
            {{ project.locations_address|nl2br }}
        </td>
    </tr>
</table>
{% if showFinance %}
<hr/>
<table style="font-size: 16px;">
    <tr>
       <td style="width: 35%;">
           Equipment SubTotal
       </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.prices.subTotal|money }}
        </td>
        <td style="width: 35%;">
            Sales
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.payments.sales.total|money }}
        </td>
    </tr>
    <tr>
        <td style="width: 35%;">
            {% if FINANCIALS.prices.discounts|moneyPositive %}Discounts{% else %}Adjustments{% endif %}
        </td>
        <td style="width: 15%;text-align: right;">
            {% if FINANCIALS.prices.discounts|moneyPositive %}&#8209;{{ FINANCIALS.prices.discounts|money }}{% else %}None{% endif %}
        </td>
        <td style="width: 35%;">
            Staffing
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.payments.staff.total|money }}
        </td>
    </tr>
    <tr>
        <td style="width: 35%;">
            <b>Equipment Total</b>
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.prices.total|money }}
        </td>
        <td  style="width: 35%;">
            Sub Hires
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.payments.subHire.total|money }}
        </td>
    </tr>
</table>
<hr/>
<table style="font-size: 16px;">
    <tr>
        <td style="width: 35%;">
            SubTotal
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.payments.subTotal|money }}
        </td>
        <td style="width: 35%;">
            Payments Received to Date
        </td>
        <td style="width: 15%;text-align: right;">
            &#8209;{{ FINANCIALS.payments.received.total|money }}
        </td>
    </tr>
    <tr>
        <td style="width: 35%;">

        </td>
        <td style="width: 15%;text-align: right;">

        </td>
        <td style="width: 35%;">
            <b>Grand Total Outstanding</b>
        </td>
        <td style="width: 15%;text-align: right;">
            {{ FINANCIALS.payments.total|money }}
        </td>
    </tr>
</table>
{% endif %}
{%  if project.projects_invoiceNotes|length > 0 %}
    <h2>Notes</h2>
    <p style="font-size: 16px;">{{ project.projects_invoiceNotes }}</p>
{% endif %}
{% if FINANCIALS.assetsAssigned|length > 0 %}
<pagebreak/>
    <h2>Equipment</h2>
<table style="text-align: left;">
    <thead>
        <tr>
            <th style="width: 90px; text-align: left;border-bottom: 1px solid black;">#</th>
            <th style="text-align: left;border-bottom: 1px solid black;">Comment</th>
            <th style="text-align: left;border-bottom: 1px solid black;" colspan="3">Spec</th>
            <th style="width: 60px;border-bottom: 1px solid black;">Mass</th>
            {% if showFinance %}<th style="border-bottom: 1px solid black;">Price</th>
            <th style="border-bottom: 1px solid black;">Disc.</th>{% endif %}
        </tr>
    </thead>
{% set currentCategory = '' %}
{% set currentType = '' %}
{% for assetAssignment in FINANCIALS.assetsAssigned %}
    {% if assetAssignment.assetCategories_name != currentCategory %}
        {% set currentCategory = assetAssignment.assetCategories_name %}
        <tr style="background-color: #F5F5F5;">
            <td colspan="{{ showFinance ? 6 : 4 }}">
                <h3>{{ assetAssignment.assetCategories_name }}</h3>
            </td>
        </tr>
    {% endif %}
    {% if assetAssignment.assetTypes_id != currentType %}
        {% set currentType = assetAssignment.assetTypes_id %}
        {% set definableFields = assetAssignment.assetTypes_definableFields_ARRAY %}
        <tr>
                <td style="font-weight: bold;" {% if definableFields|length > 3 or definableFields|length < 1 %}colspan="{{  showFinance ? 8 : 6 }}"{% else %}colspan="2"{% endif %}>
                   {{ FINANCIALS.assetTypesCounter[assetAssignment.assetTypes_id] }}x {{ assetAssignment.manufacturers_name }} - {{ assetAssignment.assetTypes_name }}
                </td>
                {% if definableFields|length < 4 and definableFields|length > 0 %}
                    {% for field in definableFields %}
                    <td style="padding:0px;"
                            {% if definableFields|length == 1 %}colspan="3"{% endif %}>
                        <b>{{field}}</b>
                    </td>
                    {% endfor %}
                    {% if definableFields|length == 2 %}<td></td>{% endif %}
                <td {{ showFinance ? 'colspan="3"'}}></td>
                {% endif %}
        </tr>
    {% endif %}
    <tr>
        <td>{{ assetAssignment.assets_tag|aTag }}</td>
        <td {% if definableFields|length < 1 %}colspan="4"{% endif %}>{{ assetAssignment.assetsAssignments_comment }}</td>
        {% if definableFields|length < 4 and definableFields|length > 0 %}
            {% if definableFields|length < 4 and definableFields|length > 0 %}
                {% for field in definableFields %}
                    <td style="padding:0px;"
                        {% if definableFields|length == 1 %}colspan="3"{% endif %}>
                        {{ assetAssignment['asset_definableFields_' ~ loop.index] }}
                    </td>
                {% endfor %}
                    {% if definableFields|length == 2 %}<td></td>{% endif %}
                {% endif %}
        {% elseif definableFields|length > 0 %}
            <td style="padding:0px;text-align: left;" colspan="3">
                {% for field in definableFields %}
                    {% if field != "" %}
                        <b>{{field}}:</b> {{ assetAssignment['asset_definableFields_' ~ loop.index] }}<br/>
                    {% endif %}
                {% endfor %}
            </td>
        {% endif %}
        <td>{{ assetAssignment.assets_mass != null ? assetAssignment.assets_mass|mass : (assetAssignment.assetTypes_mass != null and assetAssignment.assetTypes_mass != 0 ? assetAssignment.assetTypes_mass|mass : "") }}</td>
        {% if showFinance %}
            <td>{{ assetAssignment.price|money }}</td>
            <td>{{ assetAssignment.assetsAssignments_discount }}%</td>
        {% endif %}
    </tr>
{% endfor %}
{% for assetAssignment in FINANCIALS.assetsAssignedSUB %}
    {% if assetAssignment.assetInstanceName != currentInstanceForLoop %}
        {% set currentInstanceForLoop = assetAssignment.assetInstanceName %}
        </table>
        <pagebreak/>
        <h2>Business: {{ assetAssignment.assetInstanceName }}</h2>
        <table style="text-align: left;">
            <thead>
            <tr>
                <th style="width: 90px; text-align: left;border-bottom: 1px solid black;">#</th>
                <th style="text-align: left;border-bottom: 1px solid black;">Comment</th>
                <th style="text-align: left;border-bottom: 1px solid black;" colspan="3">Spec</th>
                <th style="width: 60px;border-bottom: 1px solid black;">Mass</th>
                {% if showFinance %}<th style="border-bottom: 1px solid black;">Price</th>
                    <th style="border-bottom: 1px solid black;">Disc.</th>{% endif %}
            </tr>
            </thead>
    {% endif %}
    {# Below is duplicate of Above !! #}
    {% if assetAssignment.assetCategories_name != currentCategory %}
        {% set currentCategory = assetAssignment.assetCategories_name %}
        <tr style="background-color: #F5F5F5;">
            <td colspan="{{ showFinance ? 6 : 4 }}">
                <h3>{{ assetAssignment.assetCategories_name }}</h3>
            </td>
        </tr>
    {% endif %}
    {% if assetAssignment.assetTypes_id != currentType %}
        {% set currentType = assetAssignment.assetTypes_id %}
        {% set definableFields = assetAssignment.assetTypes_definableFields_ARRAY %}
        <tr>
            <td style="font-weight: bold;" {% if definableFields|length > 3 or definableFields|length < 1 %}colspan="{{  showFinance ? 8 : 6 }}"{% else %}colspan="2"{% endif %}>
                {{ FINANCIALS.assetTypesCounter[assetAssignment.assetTypes_id] }}x {{ assetAssignment.manufacturers_name }} - {{ assetAssignment.assetTypes_name }}
            </td>
            {% if definableFields|length < 4 and definableFields|length > 0 %}
                {% for field in definableFields %}
                    <td style="padding:0px;"
                        {% if definableFields|length == 1 %}colspan="3"{% endif %}>
                        <b>{{field}}</b>
                    </td>
                {% endfor %}
                {% if definableFields|length == 2 %}<td></td>{% endif %}
                <td {{ showFinance ? 'colspan="3"'}}></td>
            {% endif %}
        </tr>
    {% endif %}
    <tr>
        <td>{{ assetAssignment.assets_tag|aTag }}</td>
        <td {% if definableFields|length < 1 %}colspan="4"{% endif %}>{{ assetAssignment.assetsAssignments_comment }}</td>
        {% if definableFields|length < 4 and definableFields|length > 0 %}
            {% if definableFields|length < 4 and definableFields|length > 0 %}
                {% for field in definableFields %}
                    <td style="padding:0px;"
                        {% if definableFields|length == 1 %}colspan="3"{% endif %}>
                        {{ assetAssignment['asset_definableFields_' ~ loop.index] }}
                    </td>
                {% endfor %}
                {% if definableFields|length == 2 %}<td></td>{% endif %}
            {% endif %}
        {% elseif definableFields|length > 0 %}
            <td style="padding:0px;text-align: left;" colspan="3">
                {% for field in definableFields %}
                    {% if field != "" %}
                        <b>{{field}}:</b> {{ assetAssignment['asset_definableFields_' ~ loop.index] }}<br/>
                    {% endif %}
                {% endfor %}
            </td>
        {% endif %}
        <td>{{assetAssignment.assetTypes_mass != "" and assetAssignment.assetTypes_mass != 0 ? assetAssignment.assetTypes_mass|mass : "" }}</td>
        {% if showFinance %}
            <td>{{ assetAssignment.price|money }}</td>
            <td>{{ assetAssignment.assetsAssignments_discount }}%</td>
        {% endif %}
    </tr>
{% endfor %}
</table>
<table>
    <tr>
        <td style="text-align: right;"><h3>{{ FINANCIALS.assetsAssigned|length }} Item{{ FINANCIALS.assetsAssigned|length != 1 ? 's' }}</h3></td>
    </tr>
</table>
{% endif %}
{% if FINANCIALS.payments.subHire.ledger|length > 0 %}
    <pagebreak/>
    <h2>Sub Hire Items</h2>
    <table border="0">
        <tbody>
        {% set currentSupplier = "" %}
        {% for payment in FINANCIALS.payments.subHire.ledger %}
            {% if currentSupplier != payment.payments_supplier %}
                {% set currentSupplier = payment.payments_supplier %}
            <tr>
                <td colspan="{{ showFinance ? 4 : 2 }}" style="background-color: #F5F5F5;"><h3>{{ payment.payments_supplier }}</h3></td>
            </tr>
            {% endif %}
            <tr>
                <td style="width: 10px;">{{ payment.payments_quantity > 1 ? payment.payments_quantity ~ "x" : "" }}</td>
                <td>{{ payment.payments_comment|nl2br }}</td>
                {% if showFinance %}
                    <td style="width:100px;text-align: right;">{{ payment.payments_amount|money }}</td>
                    <td style="width:100px;text-align: right;">{{ payment.payments_amountTotal|money }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        {% if showFinance %}
        <tr>
            <td colspan="4" style="text-align: right;"><b>Total: </b>{{ FINANCIALS.payments.subHire.total|money }}</td>
        </tr>
        {% endif %}
        </tbody>

    </table>
{% endif %}
{% if FINANCIALS.payments.sales.ledger|length > 0 %}
    <h2>Sales</h2>
    <table border="0">
        <tbody>
        {% set currentSupplier = "" %}
        {% for payment in FINANCIALS.payments.sales.ledger %}
            {% if currentSupplier != payment.payments_supplier %}
                {% set currentSupplier = payment.payments_supplier %}
                <tr>
                    <td colspan="{{ showFinance ? 4 : 2 }}" style="background-color: #F5F5F5;"><h3>{{ payment.payments_supplier }}</h3></td>
                </tr>
            {% endif %}
            <tr>
                <td style="width: 10px;">{{ payment.payments_quantity > 1 ? payment.payments_quantity ~ "x" : "" }}</td>
                <td>{{ payment.payments_comment|nl2br }}</td>
                {% if showFinance %}
                    <td style="width:100px;text-align: right;">{{ payment.payments_amount|money }}</td>
                    <td style="width:100px;text-align: right;">{{ payment.payments_amountTotal|money }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        {% if showFinance %}
            <tr>
                <td colspan="4" style="text-align: right;"><b>Total: </b>{{ FINANCIALS.payments.sales.total|money }}</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
{% endif %}
{% if FINANCIALS.payments.staff.ledger|length > 0 %}
    <h2>Staff</h2>
    <table border="0">
        <tbody>
        {% set currentSupplier = "" %}
        {% for payment in FINANCIALS.payments.staff.ledger %}
            {% if currentSupplier != payment.payments_supplier %}
                {% set currentSupplier = payment.payments_supplier %}
                <tr>
                    <td colspan="{{ showFinance ? 4 : 2 }}" style="background-color: #F5F5F5;"><h3>{{ payment.payments_supplier }}</h3></td>
                </tr>
            {% endif %}
            <tr>
                <td style="width: 10px;">{{ payment.payments_quantity > 1 ? payment.payments_quantity ~ "x" : "" }}</td>
                <td>{{ payment.payments_comment|nl2br }}</td>
                {% if showFinance %}
                    <td style="width:100px;text-align: right;">{{ payment.payments_amount|money }}</td>
                    <td style="width:100px;text-align: right;">{{ payment.payments_amountTotal|money }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        {% if showFinance %}
            <tr>
                <td colspan="4" style="text-align: right;"><b>Total: </b>{{ FINANCIALS.payments.staff.total|money }}</td>
            </tr>
        {% endif %}
        </tbody>

    </table>
{% endif %}
{% if showFinance and USERDATA.instance.instances_termsAndPayment %}
<table style="background-color: #F5F5F5; margin-top: 10px; font-size: 14px;">
    <tr>
        <td style="padding: 6px;">
            {{ USERDATA.instance.instances_termsAndPayment|nl2br }}
        </td>
    </tr>
</table>
{% endif %}
</body>